var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
import { Component } from "@angular/core";
import { Contract } from "models/contract";
import { ContractProvider } from "providers";
import { CartMode } from "../components/mode";
import { NavbarService } from "services/navbar";
let CartPage = class CartPage {
    constructor(contractProvider, navbarService) {
        this.contractProvider = contractProvider;
        this.navbarService = navbarService;
        this.history = [];
        this.cartMode = CartMode;
        this.contract = new Contract;
        this.pageMode = CartMode.Empty;
        this.showHistory = false;
        this.showError = false;
        this.contractProvider.getCart().subscribe(response => {
            this.contract = response.current;
            this.history = response.history;
            this.showHistory = this.history.length > 0;
            this.contract.final = this.getFinal(this.contract.positions);
            if (this.contract.positions && this.contract.positions.length > 0)
                this.pageMode = CartMode.Form;
        });
    }
    submit(contract) {
        this.contract = Object.assign(this.contract, contract);
        this.contractProvider.placeContract(this.contract).subscribe(response => {
            this.pageMode = CartMode.Success;
            this.history.unshift(response);
            this.navbarService.updateCartData({ sum: 0, count: 0 });
        });
    }
    del(idx) {
        this.contract.positions.splice(idx, 1);
        if (this.contract.positions.length == 0) {
            this.pageMode = CartMode.Empty;
        }
        this.contract.final = this.getFinal(this.contract.positions);
        this.contractProvider.put(this.contract).subscribe(response => {
            this.navbarService.updateCartData(response);
        });
    }
    minus(idx) {
        if (this.contract.positions[idx].count > 1) {
            this.contract.positions[idx].count--;
            let product = this.contract.positions[idx].product;
            this.contract.positions[idx].sum = product.price * this.contract.positions[idx].count;
            this.contract.final = this.getFinal(this.contract.positions);
            this.contractProvider.put(this.contract).subscribe(response => {
                this.navbarService.updateCartData(response);
            });
        }
    }
    plus(idx) {
        this.contract.positions[idx].count++;
        let product = this.contract.positions[idx].product;
        this.contract.positions[idx].sum = product.price * this.contract.positions[idx].count;
        this.contract.final = this.getFinal(this.contract.positions);
        this.contractProvider.put(this.contract).subscribe(response => {
            this.navbarService.updateCartData(response);
        });
    }
    getFinal(positions) {
        let sum = 0;
        if (positions)
            positions.forEach(position => {
                sum += position.sum;
            });
        return sum;
    }
};
CartPage = __decorate([
    Component({
        templateUrl: 'cart.html',
    }),
    __metadata("design:paramtypes", [ContractProvider,
        NavbarService])
], CartPage);
export { CartPage };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNhcnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUN4QyxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFDLGdCQUFnQixFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQzNDLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUM1QyxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFNOUMsSUFBYSxRQUFRLEdBQXJCO0lBUUksWUFBb0IsZ0JBQWtDLEVBQ2xDLGFBQTRCO1FBRDVCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFSaEQsWUFBTyxHQUFVLEVBQUUsQ0FBQztRQUNwQixhQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3BCLGFBQVEsR0FBYSxJQUFJLFFBQVEsQ0FBQztRQUNsQyxhQUFRLEdBQWEsUUFBUSxDQUFDLEtBQUssQ0FBQztRQUNwQyxnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUM3QixjQUFTLEdBQVksS0FBSyxDQUFDO1FBSXZCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxTQUFTLENBQUMsUUFBUTtZQUM5QyxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUM7WUFDakMsSUFBSSxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDO1lBQ2hDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQzNDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FB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ckMsSUFBSSxPQUFPLEdBQVksSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBa0IsQ0FBQztRQUN2RSxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDdEYsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxRQUFRO1lBQ3ZELElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFBO0lBRU4sQ0FBQztJQUVELFFBQVEsQ0FBQyxTQUFTO1FBQ2QsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQ1osRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDO1lBQ1YsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRO2dCQUN0QixHQUFHLElBQUksUUFBUSxDQUFDLEdBQUcsQ0FBQztZQUN4QixDQUFDLENBQUMsQ0FBQztRQUNQLE1BQU0sQ0FBQyxHQUFHLENBQUM7SUFDZixDQUFDO0NBQ0osQ0FBQTtBQTFFWSxRQUFRO0lBSHBCLFNBQVMsQ0FBQztRQUNQLFdBQVcsRUFBRSxXQUFXO0tBQzNCLENBQUM7cUNBU3dDLGdCQUFnQjtRQUNuQixhQUFhO0dBVHZDLFFBQVEsQ0EwRXBCO1NBMUVZLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7Q29udHJhY3R9IGZyb20gXCJtb2RlbHMvY29udHJhY3RcIjtcbmltcG9ydCB7Q29udHJhY3RQcm92aWRlcn0gZnJvbSBcInByb3ZpZGVyc1wiO1xuaW1wb3J0IHtDYXJ0TW9kZX0gZnJvbSBcIi4uL2NvbXBvbmVudHMvbW9kZVwiO1xuaW1wb3J0IHtOYXZiYXJTZXJ2aWNlfSBmcm9tIFwic2VydmljZXMvbmF2YmFyXCI7XG5pbXBvcnQge1Byb2R1Y3R9IGZyb20gXCJtb2RlbHMvcHJvZHVjdFwiO1xuXG5AQ29tcG9uZW50KHtcbiAgICB0ZW1wbGF0ZVVybDogJ2NhcnQuaHRtbCcsXG59KVxuZXhwb3J0IGNsYXNzIENhcnRQYWdlIHtcbiAgICBoaXN0b3J5OiBhbnlbXSA9IFtdO1xuICAgIGNhcnRNb2RlID0gQ2FydE1vZGU7XG4gICAgY29udHJhY3Q6IENvbnRyYWN0ID0gbmV3IENvbnRyYWN0O1xuICAgIHBhZ2VNb2RlOiBDYXJ0TW9kZSA9IENhcnRNb2RlLkVtcHR5O1xuICAgIHNob3dIaXN0b3J5OiBib29sZWFuID0gZmFsc2U7XG4gICAgc2hvd0Vycm9yOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbnRyYWN0UHJvdmlkZXI6IENvbnRyYWN0UHJvdmlkZXIsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBuYXZiYXJTZXJ2aWNlOiBOYXZiYXJTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuY29udHJhY3RQcm92aWRlci5nZXRDYXJ0KCkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIHRoaXMuY29udHJhY3QgPSByZXNwb25zZS5jdXJyZW50O1xuICAgICAgICAgICAgdGhpcy5oaXN0b3J5ID0gcmVzcG9uc2UuaGlzdG9yeTtcbiAgICAgICAgICAgIHRoaXMuc2hvd0hpc3RvcnkgPSB0aGlzLmhpc3RvcnkubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIHRoaXMuY29udHJhY3QuZmluYWwgPSB0aGlzLmdldEZpbmFsKHRoaXMuY29udHJhY3QucG9zaXRpb25zKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyYWN0LnBvc2l0aW9ucyAmJiB0aGlzLmNvbnRyYWN0LnBvc2l0aW9ucy5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgIHRoaXMucGFnZU1vZGUgPSBDYXJ0TW9kZS5Gb3JtO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIHN1Ym1pdChjb250cmFjdCkge1xuICAgICAgICB0aGlzLmNvbnRyYWN0ID0gT2JqZWN0LmFzc2lnbih0aGlzLmNvbnRyYWN0LCBjb250cmFjdCk7XG5cbiAgICAgICAgICAgIHRoaXMuY29udHJhY3RQcm92aWRlci5wbGFjZUNvbnRyYWN0KHRoaXMuY29udHJhY3QpLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYWdlTW9kZSA9IENhcnRNb2RlLlN1Y2Nlc3M7XG4gICAgICAgICAgICAgICAgdGhpcy5oaXN0b3J5LnVuc2hpZnQocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHRoaXMubmF2YmFyU2VydmljZS51cGRhdGVDYXJ0RGF0YSh7c3VtOiAwLCBjb3VudDogMH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXG5cbiAgICBkZWwoaWR4KSB7XG4gICAgICAgIHRoaXMuY29udHJhY3QucG9zaXRpb25zLnNwbGljZShpZHgsIDEpO1xuICAgICAgICBpZiAodGhpcy5jb250cmFjdC5wb3NpdGlvbnMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHRoaXMucGFnZU1vZGUgPSBDYXJ0TW9kZS5FbXB0eTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvbnRyYWN0LmZpbmFsID0gdGhpcy5nZXRGaW5hbCh0aGlzLmNvbnRyYWN0LnBvc2l0aW9ucyk7XG4gICAgICAgIHRoaXMuY29udHJhY3RQcm92aWRlci5wdXQodGhpcy5jb250cmFjdCkuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIHRoaXMubmF2YmFyU2VydmljZS51cGRhdGVDYXJ0RGF0YShyZXNwb25zZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG1pbnVzKGlkeCkge1xuICAgICAgICBpZiAodGhpcy5jb250cmFjdC5wb3NpdGlvbnNbaWR4XS5jb3VudCA+IDEpIHtcbiAgICAgICAgICAgIHRoaXMuY29udHJhY3QucG9zaXRpb25zW2lkeF0uY291bnQtLTtcbiAgICAgICAgICAgIGxldCBwcm9kdWN0OiBQcm9kdWN0ID0gdGhpcy5jb250cmFjdC5wb3NpdGlvbnNbaWR4XS5wcm9kdWN0IGFzIFByb2R1Y3Q7XG4gICAgICAgICAgICB0aGlzLmNvbnRyYWN0LnBvc2l0aW9uc1tpZHhdLnN1bSA9IHByb2R1Y3QucHJpY2UgKiB0aGlzLmNvbnRyYWN0LnBvc2l0aW9uc1tpZHhdLmNvdW50O1xuICAgICAgICAgICAgdGhpcy5jb250cmFjdC5maW5hbCA9IHRoaXMuZ2V0RmluYWwodGhpcy5jb250cmFjdC5wb3NpdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy5jb250cmFjdFByb3ZpZGVyLnB1dCh0aGlzLmNvbnRyYWN0KS5zdWJzY3JpYmUocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubmF2YmFyU2VydmljZS51cGRhdGVDYXJ0RGF0YShyZXNwb25zZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHBsdXMoaWR4KSB7XG4gICAgICAgIHRoaXMuY29udHJhY3QucG9zaXRpb25zW2lkeF0uY291bnQrKztcbiAgICAgICAgbGV0IHByb2R1Y3Q6IFByb2R1Y3QgPSB0aGlzLmNvbnRyYWN0LnBvc2l0aW9uc1tpZHhdLnByb2R1Y3QgYXMgUHJvZHVjdDtcbiAgICAgICAgdGhpcy5jb250cmFjdC5wb3NpdGlvbnNbaWR4XS5zdW0gPSBwcm9kdWN0LnByaWNlICogdGhpcy5jb250cmFjdC5wb3NpdGlvbnNbaWR4XS5jb3VudDtcbiAgICAgICAgdGhpcy5jb250cmFjdC5maW5hbCA9IHRoaXMuZ2V0RmluYWwodGhpcy5jb250cmFjdC5wb3NpdGlvbnMpO1xuICAgICAgICB0aGlzLmNvbnRyYWN0UHJvdmlkZXIucHV0KHRoaXMuY29udHJhY3QpLnN1YnNjcmliZShyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5hdmJhclNlcnZpY2UudXBkYXRlQ2FydERhdGEocmVzcG9uc2UpO1xuICAgICAgICB9KVxuXG4gICAgfVxuXG4gICAgZ2V0RmluYWwocG9zaXRpb25zKSB7XG4gICAgICAgIGxldCBzdW0gPSAwO1xuICAgICAgICBpZiAocG9zaXRpb25zKVxuICAgICAgICAgICAgcG9zaXRpb25zLmZvckVhY2gocG9zaXRpb24gPT4ge1xuICAgICAgICAgICAgICAgIHN1bSArPSBwb3NpdGlvbi5zdW07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHN1bTtcbiAgICB9XG59XG4iXX0=