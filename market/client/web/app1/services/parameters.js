var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
import { Injectable } from "@angular/core";
let ParametersService = class ParametersService {
    constructor() {
        if (!this.paramsFiltered)
            this.paramsFiltered = new Map();
    }
    filterToUrl(parameter) {
        switch (parameter.behavior) {
            case 'checklist':
            case 'radiolist':
                this.filterToUrlChecboxlist(parameter);
                break;
            case 'onecheck':
                this.filterToUrlOnecheck(parameter);
                break;
            case 'input':
                this.filterToUrlInput(parameter);
                break;
            default:
                throw Error('Неизвестный тип параметра фильтра');
        }
        return this.getUrlObject();
    }
    filterToUrlChecboxlist(parameter) {
        let valuesSelected = parameter.values.filter(v => v.selected);
        if (valuesSelected.length) {
            let valuesFiltered = valuesSelected.map(v => v.url);
            let fake = {};
            fake[parameter.url] = valuesFiltered;
            this.paramsFiltered.set(parameter._id, fake);
        }
        else {
            this.paramsFiltered.delete(parameter._id);
        }
        return this.paramsFiltered;
    }
    filterToUrlOnecheck(parameter) {
        let valuesSelected = parameter.values[0].selected;
        let fake = {};
        fake[parameter.url] = valuesSelected ? parameter.values[0].url : 'net';
        this.paramsFiltered.set(parameter._id, fake);
    }
    filterToUrlInput(parameter) {
        let valuesSelected = !!parameter.from || !!parameter.to;
        if (valuesSelected) {
            let fake = {};
            let queryValues = [];
            if (parameter.from)
                queryValues.push(`from_${parameter.from}`);
            if (parameter.to)
                queryValues.push(`to_${parameter.to}`);
            if (queryValues.length)
                fake[parameter.url] = queryValues;
            this.paramsFiltered.set(parameter._id, fake);
        }
        else {
            this.paramsFiltered.delete(parameter._id);
        }
    }
    getUrlObject() {
        let values = this.paramsFiltered.values();
        let valuesArray = Array.from(values);
        return valuesArray.length ? Object.assign({}, ...valuesArray) : {};
    }
    mergeParamsWithFilter(parameters) {
        return parameters.map(parameter => {
        });
    }
    urlToParameter(parameter, queryParams) {
        switch (parameter.behavior) {
            case 'checklist':
            case 'radiolist':
            case 'onecheck':
                return this.urlToFilterChecboxlist(parameter, queryParams);
            case 'input':
                return this.urlToFilterInput(parameter, queryParams);
            default:
                throw Error('Неизвестный тип параметра фильтра');
        }
    }
    urlToFilterChecboxlist(parameter, queryParams) {
        parameter.values.forEach(v => {
            let t = Object.keys(queryParams).map(k => queryParams[k]);
            v.selected = t.includes(v.url);
        });
        return parameter;
    }
    urlToFilterInput(parameter, queryParams) {
        let fromRegexp = new RegExp(/from_(\d+)/), toRegexp = new RegExp(/to_(\d+)/), from = fromRegexp.exec(queryParams), to = toRegexp.exec(queryParams);
        if (from)
            parameter.from = from[1];
        if (to)
            parameter.to = to[1];
        return parameter;
    }
};
ParametersService = __decorate([
    Injectable(),
    __metadata("design:paramtypes", [])
], ParametersService);
export { ParametersService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYW1ldGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBhcmFtZXRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUl6QyxJQUFhLGlCQUFpQixHQUE5QjtJQUVJO1FBQ0ksRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO1lBQ3JCLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUN4QyxDQUFDO0lBSU0sV0FBVyxDQUFDLFNBQW9CO1FBQ25DLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLEtBQUssV0FBVyxDQUFDO1lBQ2pCLEtBQUssV0FBVztnQkFDWixJQUFJLENBQUMsc0JBQXNCLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQ3ZDLEtBQUssQ0FBQztZQUNWLEtBQUssVUFBVTtnQkFDWCxJQUFJLENBQUMsbUJBQW1CLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQ3BDLEtBQUssQ0FBQztZQUVWLEtBQUssT0FBTztnQkFDUixJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQ2pDLEtBQUssQ0FBQztZQUVWO2dCQUNJLE1BQU0sS0FBSyxDQUFDLG1DQUFtQyxDQUFDLENBQUE7UUFDeEQsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7SUFDOUIsQ0FBQztJQUVPLHNCQUFzQixDQUFDLFNBQW9CO1FBQy9DLElBQUksY0FBYyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUQsRUFBRSxDQUFDLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDeEIsSUFBSSxjQUFjLEdBQWEsY0FBYyxDQUFDLEdB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TUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNyQixDQUFDO0NBQ0osQ0FBQTtBQXJIWSxpQkFBaUI7SUFEN0IsVUFBVSxFQUFFOztHQUNBLGlCQUFpQixDQXFIN0I7U0FySFksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtJbmplY3RhYmxlfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHtQYXJhbWV0ZXJ9IGZyb20gXCIuLi9lbnRpdGllcy9wYXJhbWV0ZXJcIjtcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFBhcmFtZXRlcnNTZXJ2aWNlIHtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBpZiAoIXRoaXMucGFyYW1zRmlsdGVyZWQpXG4gICAgICAgICAgICB0aGlzLnBhcmFtc0ZpbHRlcmVkID0gbmV3IE1hcCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcGFyYW1zRmlsdGVyZWQ6IE1hcDxzdHJpbmcsIG9iamVjdD47XG5cbiAgICBwdWJsaWMgZmlsdGVyVG9VcmwocGFyYW1ldGVyOiBQYXJhbWV0ZXIpIHtcbiAgICAgICAgc3dpdGNoIChwYXJhbWV0ZXIuYmVoYXZpb3IpIHtcbiAgICAgICAgICAgIGNhc2UgJ2NoZWNrbGlzdCc6XG4gICAgICAgICAgICBjYXNlICdyYWRpb2xpc3QnOlxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyVG9VcmxDaGVjYm94bGlzdChwYXJhbWV0ZXIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnb25lY2hlY2snOlxuICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyVG9VcmxPbmVjaGVjayhwYXJhbWV0ZXIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlICdpbnB1dCc6XG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJUb1VybElucHV0KHBhcmFtZXRlcik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ9Cd0LXQuNC30LLQtdGB0YLQvdGL0Lkg0YLQuNC/INC/0LDRgNCw0LzQtdGC0YDQsCDRhNC40LvRjNGC0YDQsCcpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VXJsT2JqZWN0KClcbiAgICB9XG5cbiAgICBwcml2YXRlIGZpbHRlclRvVXJsQ2hlY2JveGxpc3QocGFyYW1ldGVyOiBQYXJhbWV0ZXIpIHtcbiAgICAgICAgbGV0IHZhbHVlc1NlbGVjdGVkID0gcGFyYW1ldGVyLnZhbHVlcy5maWx0ZXIodiA9PiB2LnNlbGVjdGVkKTtcbiAgICAgICAgaWYgKHZhbHVlc1NlbGVjdGVkLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IHZhbHVlc0ZpbHRlcmVkOiBzdHJpbmdbXSA9IHZhbHVlc1NlbGVjdGVkLm1hcCh2ID0+IHYudXJsKTtcbiAgICAgICAgICAgIGxldCBmYWtlID0ge307XG4gICAgICAgICAgICBmYWtlW3BhcmFtZXRlci51cmxdID0gdmFsdWVzRmlsdGVyZWQ7XG4gICAgICAgICAgICB0aGlzLnBhcmFtc0ZpbHRlcmVkLnNldChwYXJhbWV0ZXIuX2lkLCBmYWtlKVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wYXJhbXNGaWx0ZXJlZC5kZWxldGUocGFyYW1ldGVyLl9pZClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5wYXJhbXNGaWx0ZXJlZFxuICAgIH1cblxuICAgIHByaXZhdGUgZmlsdGVyVG9VcmxPbmVjaGVjayhwYXJhbWV0ZXI6IFBhcmFtZXRlcikge1xuICAgICAgICBsZXQgdmFsdWVzU2VsZWN0ZWQgPSBwYXJhbWV0ZXIudmFsdWVzWzBdLnNlbGVjdGVkO1xuICAgICAgICBsZXQgZmFrZSA9IHt9O1xuICAgICAgICBmYWtlW3BhcmFtZXRlci51cmxdID0gdmFsdWVzU2VsZWN0ZWQgPyBwYXJhbWV0ZXIudmFsdWVzWzBdLnVybCA6ICduZXQnO1xuICAgICAgICB0aGlzLnBhcmFtc0ZpbHRlcmVkLnNldChwYXJhbWV0ZXIuX2lkLCBmYWtlKVxuICAgIH1cblxuICAgIHByaXZhdGUgZmlsdGVyVG9VcmxJbnB1dChwYXJhbWV0ZXI6IFBhcmFtZXRlcikge1xuICAgICAgICBsZXQgdmFsdWVzU2VsZWN0ZWQgPSAhIXBhcmFtZXRlci5mcm9tIHx8ICEhcGFyYW1ldGVyLnRvO1xuICAgICAgICBpZiAodmFsdWVzU2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIGxldCBmYWtlID0ge307XG4gICAgICAgICAgICBsZXQgcXVlcnlWYWx1ZXMgPSBbXTtcbiAgICAgICAgICAgIGlmIChwYXJhbWV0ZXIuZnJvbSlcbiAgICAgICAgICAgICAgICBxdWVyeVZhbHVlcy5wdXNoKGBmcm9tXyR7cGFyYW1ldGVyLmZyb219YCk7XG4gICAgICAgICAgICBpZiAocGFyYW1ldGVyLnRvKVxuICAgICAgICAgICAgICAgIHF1ZXJ5VmFsdWVzLnB1c2goYHRvXyR7cGFyYW1ldGVyLnRvfWApO1xuICAgICAgICAgICAgaWYgKHF1ZXJ5VmFsdWVzLmxlbmd0aClcbiAgICAgICAgICAgICAgICBmYWtlW3BhcmFtZXRlci51cmxdID0gcXVlcnlWYWx1ZXM7XG4gICAgICAgICAgICB0aGlzLnBhcmFtc0ZpbHRlcmVkLnNldChwYXJhbWV0ZXIuX2lkLCBmYWtlKVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wYXJhbXNGaWx0ZXJlZC5kZWxldGUocGFyYW1ldGVyLl9pZClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0VXJsT2JqZWN0KCkge1xuICAgICAgICBsZXQgdmFsdWVzID0gdGhpcy5wYXJhbXNGaWx0ZXJlZC52YWx1ZXMoKTtcbiAgICAgICAgbGV0IHZhbHVlc0FycmF5ID0gQXJyYXkuZnJvbSh2YWx1ZXMpO1xuICAgICAgICByZXR1cm4gdmFsdWVzQXJyYXkubGVuZ3RoID8gT2JqZWN0LmFzc2lnbih7fSwgLi4udmFsdWVzQXJyYXkpIDoge307XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBtZXJnZVBhcmFtc1dpdGhGaWx0ZXIocGFyYW1ldGVyczogUGFyYW1ldGVyW10pIHtcbiAgICAgICAgcmV0dXJuIHBhcmFtZXRlcnMubWFwKHBhcmFtZXRlciA9PiB7XG5cbiAgICAgICAgfSlcblxuICAgIH1cblxuICAgIHB1YmxpYyB1cmxUb1BhcmFtZXRlcihwYXJhbWV0ZXI6IFBhcmFtZXRlciwgcXVlcnlQYXJhbXMpIHtcbiAgICAgICAgc3dpdGNoIChwYXJhbWV0ZXIuYmVoYXZpb3IpIHtcbiAgICAgICAgICAgIGNhc2UgJ2NoZWNrbGlzdCc6XG4gICAgICAgICAgICBjYXNlICdyYWRpb2xpc3QnOlxuICAgICAgICAgICAgY2FzZSAnb25lY2hlY2snOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVybFRvRmlsdGVyQ2hlY2JveGxpc3QocGFyYW1ldGVyLCBxdWVyeVBhcmFtcyk7XG4gICAgICAgICAgICBjYXNlICdpbnB1dCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXJsVG9GaWx0ZXJJbnB1dChwYXJhbWV0ZXIsIHF1ZXJ5UGFyYW1zKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ9Cd0LXQuNC30LLQtdGB0YLQvdGL0Lkg0YLQuNC/INC/0LDRgNCw0LzQtdGC0YDQsCDRhNC40LvRjNGC0YDQsCcpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHVybFRvRmlsdGVyQ2hlY2JveGxpc3QocGFyYW1ldGVyOiBQYXJhbWV0ZXIsIHF1ZXJ5UGFyYW1zOmFueSkge1xuICAgICAgICBwYXJhbWV0ZXIudmFsdWVzLmZvckVhY2godiA9PiB7XG4gICAgICAgICAgICAvL2lmIChBcnJheS5pc0FycmF5KHF1ZXJ5UGFyYW1zKSlcbiAgICAgICAgICAgIGxldCB0ID0gT2JqZWN0LmtleXMocXVlcnlQYXJhbXMpLm1hcChrID0+IHF1ZXJ5UGFyYW1zW2tdKTtcbiAgICAgICAgICAgICAgICB2LnNlbGVjdGVkID0gdC5pbmNsdWRlcyh2LnVybCk7XG4gICAgICAgICAgICAvL2Vsc2VcbiAgICAgICAgICAgIC8vICAgIHYuc2VsZWN0ZWQgPSB2LnVybCA9PSBPYmplY3QudmFsdWVzKHF1ZXJ5UGFyYW1zKVswXVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcGFyYW1ldGVyO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXJsVG9GaWx0ZXJJbnB1dChwYXJhbWV0ZXI6IFBhcmFtZXRlciwgcXVlcnlQYXJhbXM6YW55KSB7XG4gICAgICAgIGxldCBmcm9tUmVnZXhwID0gbmV3IFJlZ0V4cCgvZnJvbV8oXFxkKykvKSxcbiAgICAgICAgICAgIHRvUmVnZXhwID0gbmV3IFJlZ0V4cCgvdG9fKFxcZCspLyksXG4gICAgICAgICAgICBmcm9tID0gZnJvbVJlZ2V4cC5leGVjKHF1ZXJ5UGFyYW1zKSxcbiAgICAgICAgICAgIHRvID0gdG9SZWdleHAuZXhlYyhxdWVyeVBhcmFtcyk7XG4gICAgICAgIGlmIChmcm9tKVxuICAgICAgICAgICAgcGFyYW1ldGVyLmZyb20gPSBmcm9tWzFdO1xuICAgICAgICBpZiAodG8pXG4gICAgICAgICAgICBwYXJhbWV0ZXIudG8gPSB0b1sxXTtcbiAgICAgICAgcmV0dXJuIHBhcmFtZXRlcjtcbiAgICB9XG59Il19