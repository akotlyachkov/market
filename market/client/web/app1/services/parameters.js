var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
import { Injectable } from "@angular/core";
let ParametersService = class ParametersService {
    constructor() {
        if (!this.paramsFiltered)
            this.paramsFiltered = new Map();
    }
    filterToUrlFactory(parameter) {
        switch (parameter.behavior) {
            case 'checklist':
            case 'radiolist':
                this.filterToUrlChecboxlist(parameter);
                break;
            case 'onecheck':
                this.filterToUrlOnecheck(parameter);
                break;
            case 'input':
                this.filterToUrlInput(parameter);
                break;
            default:
                throw Error('Неизвестный тип параметра фильтра');
        }
        return this.getUrlObject();
    }
    filterToUrlChecboxlist(parameter) {
        let valuesSelected = parameter.values.filter(v => v.selected);
        if (valuesSelected.length) {
            let valuesFiltered = valuesSelected.map(v => v.url);
            let fake = {};
            fake[parameter.url] = valuesFiltered;
            this.paramsFiltered.set(parameter._id, fake);
        }
        else {
            this.paramsFiltered.delete(parameter._id);
        }
        return this.paramsFiltered;
    }
    filterToUrlOnecheck(parameter) {
        let valuesSelected = parameter.values[0].selected;
        let fake = {};
        fake[parameter.url] = valuesSelected ? parameter.values[0].url : 'net';
        this.paramsFiltered.set(parameter._id, fake);
    }
    filterToUrlInput(parameter) {
        let valuesSelected = !!parameter.from || !!parameter.to;
        if (valuesSelected) {
            let fake = {};
            let queryValues = [];
            if (parameter.from)
                queryValues.push(`from_${parameter.from}`);
            if (parameter.to)
                queryValues.push(`to_${parameter.to}`);
            if (queryValues.length)
                fake[parameter.url] = queryValues;
            this.paramsFiltered.set(parameter._id, fake);
        }
        else {
            this.paramsFiltered.delete(parameter._id);
        }
    }
    getUrlObject() {
        let values = this.paramsFiltered.values();
        let valuesArray = Array.from(values);
        return valuesArray.length ? Object.assign({}, ...valuesArray) : {};
    }
    urlToFilterFactory(behavior) {
        switch (behavior) {
            case 'checklist':
            case 'radiolist':
            case 'onecheck':
                return this.urlToFilterChecboxlist;
            case 'input':
                return this.urlToFilterInput;
            default:
                throw Error('Неизвестный тип фильтра');
        }
    }
    urlToFilterChecboxlist(parameter, queryValue) {
        parameter.values.forEach(v => {
            if (Array.isArray(queryValue))
                v.selected = queryValue.includes(v.url);
            else
                v.selected = v.url == queryValue;
        });
        return parameter;
    }
    urlToFilterInput(parameter, queryValue) {
        let fromRegexp = new RegExp(/from_(\d+)/), toRegexp = new RegExp(/to_(\d+)/), from = fromRegexp.exec(queryValue), to = toRegexp.exec(queryValue);
        if (from)
            parameter.from = from[1];
        if (to)
            parameter.to = to[1];
        return parameter;
    }
};
ParametersService = __decorate([
    Injectable(),
    __metadata("design:paramtypes", [])
], ParametersService);
export { ParametersService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYW1ldGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBhcmFtZXRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUl6QyxJQUFhLGlCQUFpQixHQUE5QjtJQUVJO1FBQ0ksRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDO1lBQ3JCLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUN4QyxDQUFDO0lBSU0sa0JBQWtCLENBQUMsU0FBb0I7UUFDMUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDekIsS0FBSyxXQUFXLENBQUM7WUFDakIsS0FBSyxXQUFXO2dCQUNaLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDdkMsS0FBSyxDQUFDO1lBQ1YsS0FBSyxVQUFVO2dCQUNYLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDcEMsS0FBSyxDQUFDO1lBRVYsS0FBSyxPQUFPO2dCQUNSLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDakMsS0FBSyxDQUFDO1lBRVY7Z0JBQ0ksTUFBTSxLQUFLLENBQUMsbUNBQW1DLENBQUMsQ0FBQTtRQUN4RCxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtJQUM5QixDQUFDO0lBRU8sc0JBQXNCLENBQUMsU0FBb0I7UUFDL0MsSUFBSSxjQUFjLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5RCxFQUFFLENBQUMsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN4QixJQUFJLGNBQWMsR0FBYSxjQUFjLENBQUMs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ZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7UGFyYW1ldGVyfSBmcm9tIFwiLi4vZW50aXRpZXMvcGFyYW1ldGVyXCI7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBQYXJhbWV0ZXJzU2VydmljZSB7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgaWYgKCF0aGlzLnBhcmFtc0ZpbHRlcmVkKVxuICAgICAgICAgICAgdGhpcy5wYXJhbXNGaWx0ZXJlZCA9IG5ldyBNYXAoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBhcmFtc0ZpbHRlcmVkOiBNYXA8c3RyaW5nLCBvYmplY3Q+O1xuXG4gICAgcHVibGljIGZpbHRlclRvVXJsRmFjdG9yeShwYXJhbWV0ZXI6IFBhcmFtZXRlcikge1xuICAgICAgICBzd2l0Y2ggKHBhcmFtZXRlci5iZWhhdmlvcikge1xuICAgICAgICAgICAgY2FzZSAnY2hlY2tsaXN0JzpcbiAgICAgICAgICAgIGNhc2UgJ3JhZGlvbGlzdCc6XG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJUb1VybENoZWNib3hsaXN0KHBhcmFtZXRlcik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdvbmVjaGVjayc6XG4gICAgICAgICAgICAgICAgdGhpcy5maWx0ZXJUb1VybE9uZWNoZWNrKHBhcmFtZXRlcik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgJ2lucHV0JzpcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlclRvVXJsSW5wdXQocGFyYW1ldGVyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcign0J3QtdC40LfQstC10YHRgtC90YvQuSDRgtC40L8g0L/QsNGA0LDQvNC10YLRgNCwINGE0LjQu9GM0YLRgNCwJylcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5nZXRVcmxPYmplY3QoKVxuICAgIH1cblxuICAgIHByaXZhdGUgZmlsdGVyVG9VcmxDaGVjYm94bGlzdChwYXJhbWV0ZXI6IFBhcmFtZXRlcikge1xuICAgICAgICBsZXQgdmFsdWVzU2VsZWN0ZWQgPSBwYXJhbWV0ZXIudmFsdWVzLmZpbHRlcih2ID0+IHYuc2VsZWN0ZWQpO1xuICAgICAgICBpZiAodmFsdWVzU2VsZWN0ZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICBsZXQgdmFsdWVzRmlsdGVyZWQ6IHN0cmluZ1tdID0gdmFsdWVzU2VsZWN0ZWQubWFwKHYgPT4gdi51cmwpO1xuICAgICAgICAgICAgbGV0IGZha2UgPSB7fTtcbiAgICAgICAgICAgIGZha2VbcGFyYW1ldGVyLnVybF0gPSB2YWx1ZXNGaWx0ZXJlZDtcbiAgICAgICAgICAgIHRoaXMucGFyYW1zRmlsdGVyZWQuc2V0KHBhcmFtZXRlci5faWQsIGZha2UpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBhcmFtc0ZpbHRlcmVkLmRlbGV0ZShwYXJhbWV0ZXIuX2lkKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmFtc0ZpbHRlcmVkXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaWx0ZXJUb1VybE9uZWNoZWNrKHBhcmFtZXRlcjogUGFyYW1ldGVyKSB7XG4gICAgICAgIGxldCB2YWx1ZXNTZWxlY3RlZCA9IHBhcmFtZXRlci52YWx1ZXNbMF0uc2VsZWN0ZWQ7XG4gICAgICAgIGxldCBmYWtlID0ge307XG4gICAgICAgIGZha2VbcGFyYW1ldGVyLnVybF0gPSB2YWx1ZXNTZWxlY3RlZCA/IHBhcmFtZXRlci52YWx1ZXNbMF0udXJsIDogJ25ldCc7XG4gICAgICAgIHRoaXMucGFyYW1zRmlsdGVyZWQuc2V0KHBhcmFtZXRlci5faWQsIGZha2UpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaWx0ZXJUb1VybElucHV0KHBhcmFtZXRlcjogUGFyYW1ldGVyKSB7XG4gICAgICAgIGxldCB2YWx1ZXNTZWxlY3RlZCA9ICEhcGFyYW1ldGVyLmZyb20gfHwgISFwYXJhbWV0ZXIudG87XG4gICAgICAgIGlmICh2YWx1ZXNTZWxlY3RlZCkge1xuICAgICAgICAgICAgbGV0IGZha2UgPSB7fTtcbiAgICAgICAgICAgIGxldCBxdWVyeVZhbHVlcyA9IFtdO1xuICAgICAgICAgICAgaWYgKHBhcmFtZXRlci5mcm9tKVxuICAgICAgICAgICAgICAgIHF1ZXJ5VmFsdWVzLnB1c2goYGZyb21fJHtwYXJhbWV0ZXIuZnJvbX1gKTtcbiAgICAgICAgICAgIGlmIChwYXJhbWV0ZXIudG8pXG4gICAgICAgICAgICAgICAgcXVlcnlWYWx1ZXMucHVzaChgdG9fJHtwYXJhbWV0ZXIudG99YCk7XG4gICAgICAgICAgICBpZiAocXVlcnlWYWx1ZXMubGVuZ3RoKVxuICAgICAgICAgICAgICAgIGZha2VbcGFyYW1ldGVyLnVybF0gPSBxdWVyeVZhbHVlcztcbiAgICAgICAgICAgIHRoaXMucGFyYW1zRmlsdGVyZWQuc2V0KHBhcmFtZXRlci5faWQsIGZha2UpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBhcmFtc0ZpbHRlcmVkLmRlbGV0ZShwYXJhbWV0ZXIuX2lkKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRVcmxPYmplY3QoKSB7XG4gICAgICAgIGxldCB2YWx1ZXMgPSB0aGlzLnBhcmFtc0ZpbHRlcmVkLnZhbHVlcygpO1xuICAgICAgICBsZXQgdmFsdWVzQXJyYXkgPSBBcnJheS5mcm9tKHZhbHVlcyk7XG4gICAgICAgIHJldHVybiB2YWx1ZXNBcnJheS5sZW5ndGggPyBPYmplY3QuYXNzaWduKHt9LCAuLi52YWx1ZXNBcnJheSkgOiB7fTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdXJsVG9GaWx0ZXJGYWN0b3J5KGJlaGF2aW9yKSB7XG4gICAgICAgIHN3aXRjaCAoYmVoYXZpb3IpIHtcbiAgICAgICAgICAgIGNhc2UgJ2NoZWNrbGlzdCc6XG4gICAgICAgICAgICBjYXNlICdyYWRpb2xpc3QnOlxuICAgICAgICAgICAgY2FzZSAnb25lY2hlY2snOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVybFRvRmlsdGVyQ2hlY2JveGxpc3Q7XG4gICAgICAgICAgICBjYXNlICdpbnB1dCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXJsVG9GaWx0ZXJJbnB1dDtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ9Cd0LXQuNC30LLQtdGB0YLQvdGL0Lkg0YLQuNC/INGE0LjQu9GM0YLRgNCwJylcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgdXJsVG9GaWx0ZXJDaGVjYm94bGlzdChwYXJhbWV0ZXI6IFBhcmFtZXRlciwgcXVlcnlWYWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIHBhcmFtZXRlci52YWx1ZXMuZm9yRWFjaCh2ID0+IHtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHF1ZXJ5VmFsdWUpKVxuICAgICAgICAgICAgICAgIHYuc2VsZWN0ZWQgPSBxdWVyeVZhbHVlLmluY2x1ZGVzKHYudXJsKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICB2LnNlbGVjdGVkID0gdi51cmwgPT0gcXVlcnlWYWx1ZVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcGFyYW1ldGVyO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXJsVG9GaWx0ZXJJbnB1dChwYXJhbWV0ZXI6IFBhcmFtZXRlciwgcXVlcnlWYWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIGxldCBmcm9tUmVnZXhwID0gbmV3IFJlZ0V4cCgvZnJvbV8oXFxkKykvKSxcbiAgICAgICAgICAgIHRvUmVnZXhwID0gbmV3IFJlZ0V4cCgvdG9fKFxcZCspLyksXG4gICAgICAgICAgICBmcm9tID0gZnJvbVJlZ2V4cC5leGVjKHF1ZXJ5VmFsdWUpLFxuICAgICAgICAgICAgdG8gPSB0b1JlZ2V4cC5leGVjKHF1ZXJ5VmFsdWUpO1xuICAgICAgICBpZiAoZnJvbSlcbiAgICAgICAgICAgIHBhcmFtZXRlci5mcm9tID0gZnJvbVsxXTtcbiAgICAgICAgaWYgKHRvKVxuICAgICAgICAgICAgcGFyYW1ldGVyLnRvID0gdG9bMV07XG4gICAgICAgIHJldHVybiBwYXJhbWV0ZXI7XG4gICAgfVxufSJdfQ==